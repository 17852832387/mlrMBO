<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Noisy Optimization • mlrMBO</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">mlrMBO</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/mlrMBO.html">
    <span class="fa fa-bolt"></span>
     
    Quickstart
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-file-text-o"></span>
     
    Topics
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/mixed_space_optimization.html">Mixed Space Optimization</a>
    </li>
    <li>
      <a href="../articles/parallelization.html">Parallelization</a>
    </li>
    <li>
      <a href="../articles/noisy_optimization.html">Noisy Optimization</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fa fa-book"></span>
     
    Reference
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mlr-org/mlrMBO">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Noisy Optimization</h1>
            
          </div>

    
    
<div class="contents">
<div id="purpose" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#purpose" class="anchor"> </a></body></html>Purpose</h2>
<p>This vignette will give you a short overview about techniques in <strong>mlrMBO</strong> to handle optimization of noisy objective functions.</p>
<p>You can also try to reduce noise by using parallel evaluations of the same setting as explained in the Vignette about parallelization.</p>
</div>
<div id="infill-criteria-for-noiy-optimization" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#infill-criteria-for-noiy-optimization" class="anchor"> </a></body></html>Infill criteria for noiy optimization</h2>
<p>Like always let’s start with the function we want to optimize, but this time it will be noisy. Note that Kriging requires heteroscedasticity but slight dependencies of the variance on the <code>x</code> can be acceptable like in the following example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(mlrMBO)
<span class="kw">library</span>(ggplot2)
fun =<span class="st"> </span>function(x) {
  <span class="kw">rnorm</span>(<span class="dv">1</span>, <span class="dt">mean =</span> x^<span class="dv">2</span>, <span class="dt">sd =</span> <span class="fl">0.1</span> +<span class="st"> </span><span class="fl">0.1</span>*<span class="st"> </span>x<span class="dv">+5</span>)
}
obj.fun =<span class="st"> </span><span class="kw">makeSingleObjectiveFunction</span>(<span class="dt">name =</span> <span class="st">"noisy_parable"</span>, <span class="dt">fn =</span> fun, <span class="dt">has.simple.signature =</span> <span class="ot">TRUE</span>, <span class="dt">par.set =</span> <span class="kw">makeNumericParamSet</span>(<span class="st">"x"</span>, <span class="dv">1</span>, -<span class="dv">5</span>, <span class="dv">5</span>), <span class="dt">noisy =</span> <span class="ot">TRUE</span>)
<span class="co"># visualize the function</span>
<span class="kw">autoplot</span>(obj.fun, <span class="dt">render.levels =</span> <span class="ot">TRUE</span>, <span class="dt">show.optimum =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="noisy_optimization_files/figure-html/objective_function-1.png" width="672"></p>
<p>As you can see the function is more noisy for large values of <code>x</code> so that the true optimum at <code>x=0</code> appears to be hidden. It is important to consider the way the final solution is generated (<code>final.method</code>). By default the best observed <code>y</code> value and its corresponding <code>x</code>-values are returned as the optimal solution but in the case of noisy optimization the lowest observed <code>y</code> value can just be the result of noise. Preferably the <em>best predicted</em> value of <code>y</code> is taken as the prediction of the surrogate reflects the mean and is less affected by the noise.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ctrl =<span class="st"> </span><span class="kw"><a href="../reference/makeMBOControl.html">makeMBOControl</a></span>(<span class="dt">final.method =</span> <span class="st">"best.predicted"</span>, <span class="dt">final.evals =</span> <span class="dv">10</span>)</code></pre></div>
<p>For noisy optimization we there are two infill.criteria that are recommended: * <code>aei</code>: Augmented Expected Improvement * <code>eqi</code>: Expected Quantile Improvement</p>
<div id="expected-quantile-improvement" class="section level3">
<h3 class="hasAnchor">
<html><body><a href="#expected-quantile-improvement" class="anchor"> </a></body></html>Expected Quantile Improvement</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ctrl =<span class="st"> </span><span class="kw"><a href="../reference/setMBOControlInfill.html">setMBOControlInfill</a></span>(ctrl, <span class="dt">crit =</span> crit.eqi)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ctrl =<span class="st"> </span><span class="kw"><a href="../reference/setMBOControlTermination.html">setMBOControlTermination</a></span>(ctrl, <span class="dt">iters =</span> <span class="dv">6</span>)</code></pre></div>
<p>For simplification we will let MBO automatically decide for the regression method and the initial design. As the parameter space is purely numeric MBO will use Kriging, which is exactly what we want.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Kriging can create a lot of console output, which we want tu surpress here:</span>
<span class="kw">configureMlr</span>(<span class="dt">on.learner.warning =</span> <span class="st">"quiet"</span>, <span class="dt">show.learner.output =</span> <span class="ot">FALSE</span>)
res =<span class="st"> </span><span class="kw"><a href="../reference/mbo.html">mbo</a></span>(obj.fun, <span class="dt">control =</span> ctrl, <span class="dt">show.info =</span> <span class="ot">FALSE</span>)
res
## Recommended parameters:
## x=2.44
## Objective: y = 4.406
## 
## Optimization path
## 4 + 16 entries in total, displaying last 10 (or less):
##           x          y dob eol error.message exec.time eqi error.model
## 11 2.440427  4.4603116   7  NA          &lt;NA&gt;         0  NA        &lt;NA&gt;
## 12 2.440427 -0.4012965   7  NA          &lt;NA&gt;         0  NA        &lt;NA&gt;
## 13 2.440427 11.1891347   7  NA          &lt;NA&gt;         0  NA        &lt;NA&gt;
## 14 2.440427 -2.2141046   7  NA          &lt;NA&gt;         0  NA        &lt;NA&gt;
## 15 2.440427 -4.0648537   7  NA          &lt;NA&gt;         0  NA        &lt;NA&gt;
## 16 2.440427  5.4177340   7  NA          &lt;NA&gt;         0  NA        &lt;NA&gt;
## 17 2.440427  9.3219022   7  NA          &lt;NA&gt;         0  NA        &lt;NA&gt;
## 18 2.440427 11.2333877   7  NA          &lt;NA&gt;         0  NA        &lt;NA&gt;
## 19 2.440427  4.2733438   7  NA          &lt;NA&gt;         0  NA        &lt;NA&gt;
## 20 2.440427  4.8437404   7  NA          &lt;NA&gt;         0  NA        &lt;NA&gt;
##    train.time  prop.type propose.time se mean tau
## 11         NA final_eval           NA NA   NA  NA
## 12         NA final_eval           NA NA   NA  NA
## 13         NA final_eval           NA NA   NA  NA
## 14         NA final_eval           NA NA   NA  NA
## 15         NA final_eval           NA NA   NA  NA
## 16         NA final_eval           NA NA   NA  NA
## 17         NA final_eval           NA NA   NA  NA
## 18         NA final_eval           NA NA   NA  NA
## 19         NA final_eval           NA NA   NA  NA
## 20         NA final_eval           NA NA   NA  NA</code></pre></div>
<p>As you can see the optimization got fairly close to the minimum at <code>x = 0</code> even though the noise in this area is pretty high.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(<span class="dt">final.y =</span> <span class="kw">getOptPathY</span>(res$opt.path, <span class="dt">dob =</span> <span class="dv">7</span>))
<span class="kw">var</span>(final.y)
##  [1]  4.4603116 -0.4012965 11.1891347 -2.2141046 -4.0648537  5.4177340
##  [7]  9.3219022 11.2333877  4.2733438  4.8437404
## [1] 28.52414</code></pre></div>
</div>
<div id="augmented-expected-improvement" class="section level3">
<h3 class="hasAnchor">
<html><body><a href="#augmented-expected-improvement" class="anchor"> </a></body></html>Augmented Expected Improvement</h3>
<p>We can conduct the same optimization using the aei criterion. This time we will make use of <code>exampleRun</code> to visualize the optimization.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ctrl =<span class="st"> </span><span class="kw"><a href="../reference/setMBOControlInfill.html">setMBOControlInfill</a></span>(ctrl, <span class="dt">crit =</span> crit.aei)
<span class="co"># Kriging can create a lot of console output, which we want tu surpress here:</span>
<span class="kw">configureMlr</span>(<span class="dt">on.learner.warning =</span> <span class="st">"quiet"</span>, <span class="dt">show.learner.output =</span> <span class="ot">FALSE</span>)
res =<span class="st"> </span><span class="kw"><a href="../reference/exampleRun.html">exampleRun</a></span>(obj.fun, <span class="dt">control =</span> ctrl, <span class="dt">show.info =</span> <span class="ot">FALSE</span>)
<span class="kw"><a href="../reference/plotExampleRun.html">plotExampleRun</a></span>(res, <span class="dt">pause =</span> <span class="ot">FALSE</span>)</code></pre></div>
<p><img src="noisy_optimization_files/figure-html/infill.aei-1.png" width="672"><img src="noisy_optimization_files/figure-html/infill.aei-2.png" width="672"><img src="noisy_optimization_files/figure-html/infill.aei-3.png" width="672"><img src="noisy_optimization_files/figure-html/infill.aei-4.png" width="672"><img src="noisy_optimization_files/figure-html/infill.aei-5.png" width="672"><img src="noisy_optimization_files/figure-html/infill.aei-6.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">res$mbo.res
## Recommended parameters:
## x=0.113
## Objective: y = -0.028
## 
## Optimization path
## 4 + 16 entries in total, displaying last 10 (or less):
##            x          y dob eol error.message exec.time aei error.model
## 11 0.1128333 10.0967394   7  NA          &lt;NA&gt;     0.001  NA        &lt;NA&gt;
## 12 0.1128333 -7.5250288   7  NA          &lt;NA&gt;     0.000  NA        &lt;NA&gt;
## 13 0.1128333 -5.4889464   7  NA          &lt;NA&gt;     0.000  NA        &lt;NA&gt;
## 14 0.1128333 -4.4596964   7  NA          &lt;NA&gt;     0.000  NA        &lt;NA&gt;
## 15 0.1128333  5.7127241   7  NA          &lt;NA&gt;     0.000  NA        &lt;NA&gt;
## 16 0.1128333  7.7456497   7  NA          &lt;NA&gt;     0.000  NA        &lt;NA&gt;
## 17 0.1128333  4.8494201   7  NA          &lt;NA&gt;     0.000  NA        &lt;NA&gt;
## 18 0.1128333 -5.6016273   7  NA          &lt;NA&gt;     0.000  NA        &lt;NA&gt;
## 19 0.1128333  0.6701636   7  NA          &lt;NA&gt;     0.000  NA        &lt;NA&gt;
## 20 0.1128333 -6.2789760   7  NA          &lt;NA&gt;     0.000  NA        &lt;NA&gt;
##    train.time  prop.type propose.time se mean tau
## 11         NA final_eval           NA NA   NA  NA
## 12         NA final_eval           NA NA   NA  NA
## 13         NA final_eval           NA NA   NA  NA
## 14         NA final_eval           NA NA   NA  NA
## 15         NA final_eval           NA NA   NA  NA
## 16         NA final_eval           NA NA   NA  NA
## 17         NA final_eval           NA NA   NA  NA
## 18         NA final_eval           NA NA   NA  NA
## 19         NA final_eval           NA NA   NA  NA
## 20         NA final_eval           NA NA   NA  NA</code></pre></div>
<p><em>work in progress</em></p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#purpose">Purpose</a></li>
      <li><a href="#infill-criteria-for-noiy-optimization">Infill criteria for noiy optimization</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Bernd Bischl, Jakob Bossek, Jakob Richter, Daniel Horn, Michel Lang, Janek Thomas.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
