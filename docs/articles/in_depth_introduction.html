<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>In Depth Introduction • mlrMBO</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">mlrMBO</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/mlrMBO.html">Quickstart</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mlr-org/mlrMBO">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>In Depth Introduction</h1>
            
          </div>

    
    
<div class="contents">
<p>This Vignette is supposed to give you a more in-depth introduction to <strong>mlrMBO</strong> and the principles and different approaches of model-based optimization.</p>
<div id="objective-function" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#objective-function" class="anchor"> </a></body></html>Objective Function</h2>
<p>We use the Branin function for this example.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">objfun1 =<span class="st"> </span><span class="kw">makeBraninFunction</span>()
ggplot2::<span class="kw">autoplot</span>(objfun1, <span class="dt">render.levels =</span> <span class="ot">TRUE</span>, <span class="dt">show.optimum =</span> <span class="ot">TRUE</span>)
## Warning: Ignoring unknown aesthetics: fill</code></pre></div>
<p><img src="in_depth_introduction_files/figure-html/unnamed-chunk-1-1.png" width="672"></p>
</div>
<div id="initial-design" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#initial-design" class="anchor"> </a></body></html>Initial Design</h2>
<p>The second argument of the <code><a href="../reference/mbo.html">mbo()</a></code> function - <code>design</code> - is the initial design with default setting <code>NULL</code>.</p>
<p>An easy (and recommended) way to create an initial design is to use the <code>generateDesign()</code> function from the <strong>ParamHelpers</strong> package. If no design is given (i.e. <code>design = NULL</code>) a <em>Maximin Latin Hypercube</em> <code>lhs::maximinLHS()</code> design is used with <code>n = 4 * getNumberOfParameters(objfun1)</code> points. Other possibilities to generate designs are for example <code>generateGridDesign</code> and <code>generateRandomDesign</code>.</p>
<p><em>Note:</em> If special designs are desired (e.g., orthogonal designs), they can be given as a <code>data.frame</code> but you have to make sure that the output resembles the output of <code>generateDesign()</code>.</p>
<p>For our objective function <code>objfun1</code> we create a slightly larger number of initial points than the default suggests.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">n =<span class="st"> </span><span class="dv">5</span> *<span class="st"> </span><span class="kw">getNumberOfParameters</span>(objfun1)
des =<span class="st"> </span><span class="kw">generateDesign</span>(<span class="dt">n =</span> n, <span class="dt">par.set =</span> <span class="kw">getParamSet</span>(objfun1), <span class="dt">fun =</span> lhs::randomLHS)</code></pre></div>
<p>If the design does not include the results of the objective function <em>mbo</em> will automatically calculate them in advance. Sometimes it makes sense to precalculate the results because you might want to reuse the design. In our case it is quite easy:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">des$y =<span class="st"> </span><span class="kw">apply</span>(des, <span class="dv">1</span>, objfun1)</code></pre></div>
<p><em>Note:</em> <em>mlrMBO</em> uses <code>y</code> as a default name for the outcome of the objective function. This can be changed in the control object.</p>
</div>
<div id="surrogate-model" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#surrogate-model" class="anchor"> </a></body></html>Surrogate Model</h2>
<p>In our example we use <em>Kiriging</em> as a surrogate because it is the most common for numerical model-based optimization and has prooven to be quite effective. We use <strong>mlr</strong> to generate the Kriging regression learner from the package <strong>DiceKriging</strong>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">surr.km =<span class="st"> </span><span class="kw">makeLearner</span>(<span class="st">"regr.km"</span>, <span class="dt">predict.type =</span> <span class="st">"se"</span>, <span class="dt">covtype =</span> <span class="st">"matern3_2"</span>, <span class="dt">control =</span> <span class="kw">list</span>(<span class="dt">trace =</span> <span class="ot">FALSE</span>))</code></pre></div>
<p>In fact you can use any other regression learner from <strong>mlr</strong> as a surrogate. Depending on the <em>infill criterion</em> we will set later it is important that the learner can predict the <em>uncertainty</em> (defined by <code>predict.type = "se"</code>) alongside the <em>mean</em> prediction. Another popular surrogate would be the random forest. It’s use is explained in the Vignette for <em>mixed space optimization</em>.</p>
</div>
<div id="mbocontrol" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#mbocontrol" class="anchor"> </a></body></html>MBOControl</h2>
<p>The <code>MBOControl</code> object controls the optimization process and is created with <code><a href="../reference/makeMBOControl.html">makeMBOControl()</a></code>. All parameters are documented in <code><a href="../reference/makeMBOControl.html">?makeMBOControl</a></code>. Some that influence the way MBO works are e.g.: * <code>n.objectives</code>: The number of objectives. 1 implies normal single criteria optimization and is covered in this page. For values &gt;1 see the Vignette for <em>multi-objective optimization</em>. * <code>propose.points</code>: The number of evaluated points in each iteration. The default is 1 and refers to the standard SMBO process. Higher values suggest that you want to do <em>parallelization</em> (see Vignette). * <code>final.method</code>: Defines how the final solution is proposed from the finished optimization process. The default is to return the best reached value of <code>y</code> and its corresponding <code>x</code>. However, this can give misleading results for noisy functions.</p>
<div id="mbocontrolinfill" class="section level3">
<h3 class="hasAnchor">
<html><body><a href="#mbocontrolinfill" class="anchor"> </a></body></html>MBOControlInfill</h3>
<p>With <code><a href="../reference/setMBOControlInfill.html">setMBOControlInfill()</a></code> you can change the default infill criterion settings in the <code>MBOControl</code> object. It is highly recommended to adjust the settings to suit your optimization problem and the surrogate model.</p>
<div id="argument-crit" class="section level4">
<h4 class="hasAnchor">
<html><body><a href="#argument-crit" class="anchor"> </a></body></html>Argument <em>crit</em>
</h4>
<p>An important role plays the choice of how the next design points in the sequential loop are chosen. 5 different infill criteria can be set via the <code>crit</code> argument in <code><a href="../reference/setMBOControlInfill.html">setMBOControlInfill()</a></code>:</p>
<ul>
<li>
<code>mean</code>: mean response of the surrogate model.</li>
<li>
<code>ei</code>: expected improvement of the surrogate model, which is the recommended setting if you use a <em>Kriging</em> surrogate.</li>
<li>
<code>aei</code>: augmented expected improvement, which is especially useful for noisy functions.</li>
<li>
<code>eqi</code>: expected quantile improvement.</li>
<li>
<code>cb</code>: confidence bound, which is the additive combination of mean response and mean standard error estimation of the surrogate model (<span class="math inline">\(\hat{\mu} - \lambda \cdot \hat{s}\)</span>).</li>
</ul>
<p>Here you can also further configure the infill criterion (e.g. <code>crit.cb.lambds</code> for the lambda parameter if <code>crit == "cb"</code>).</p>
<p><em>Note:</em> When using <em>Kriging</em> as a surrogate, numerical problems can occur if training points are too close to each other. To circumvent this problem you can set <code>filter.proposed.points</code> to <code>TRUE</code>. Then points closer then the value of <code>filter.proposed.points.tol</code> to an already evaluated point will be replaced with a random point.</p>
</div>
<div id="argument-opt" class="section level4">
<h4 class="hasAnchor">
<html><body><a href="#argument-opt" class="anchor"> </a></body></html>Argument <em>opt</em>
</h4>
<p>The key idea behind model-based optimization is to substitute the expensive optimization on the black-box with optimization on the surrogate as this is deemed to be cheaper. To optimize the infill criterion on the surrogate we also need an optimizer. The optimum of the infill criterion function gives us the candidate to be evaluated on the expensive function. Which one to use can be defined with the <code>opt</code> argument. The possibilities are:</p>
<ul>
<li>
<code>focussearch</code>: A Latin Hypercube design of size <code>opt.focussearch.points</code> (default 10000) is sampled in the parameter space (by <code>randomLHS</code>) and the design point with the best prediction of the infill criterion is determined. Then, the parameter space is shrunk around this point. This step is repeated <code>opt.focussearch.maxit</code> (default 5) times and the best observed point is passed back.</li>
<li>
<code>cmaes</code>: The optimal point is found with a covariance matrix adapting evolutionary strategy from the <strong>cmaes</strong> package. If the strategy fails, a random point is generated and a warning is given. Further control arguments can be provided in <code>opt.cmaes.control</code> as a list.</li>
<li>
<code>ea</code>: Use an evolutionary multiobjective optimization algorithm from the package <strong>emoa</strong> to determine the best point. The population size mu can be set by <code>opt.ea.mu</code> (default value is 10). (mu+1) means that in each population only one child is generated using crossover and mutation operators. The parameters <code>eta</code> and <code>p</code> of the latter two operators can be adjusted via the attributes <code>opt.ea.sbx.eta</code>, <code>opt.ea.sbx.p</code>,<code>opt.ea.pm.eta</code> and <code>opt.ea.pm.p</code>. The default number of EA iterations is 500 and can be changed by <code>opt.ea.maxit</code> attribute.</li>
<li>
<code>nsga2</code>: Use the non-dominated sorting genetic algorithm from the package <strong>nsga2R</strong> to determine the best point. This algorithm should be used for <em>multi objective optimization</em> (see Vignette).</li>
</ul>
<p>As all four infill optimization strategies do not guarantee to find the global optimum, users can set the number of restarts by the <code>opt.restarts</code> argument (default value is 1). Of all restarts the best infill criterion value determines the candidate to be evaluated.</p>
<p><em>Note:</em> Only the <code>focussearch</code> optimizer is suitable for for categorical parameters in the parameter set.</p>
</div>
</div>
<div id="setmbocontroltermination" class="section level3">
<h3 class="hasAnchor">
<html><body><a href="#setmbocontroltermination" class="anchor"> </a></body></html>setMBOControlTermination</h3>
<p>With <code><a href="../reference/setMBOControlTermination.html">setMBOControlTermination()</a></code> you can set multiple stopping criteria and the first one that is met will terminate the optimization process, e.g:</p>
<ul>
<li>
<code>iters</code>: The maximum number of iterations</li>
<li>
<code>time.budget</code>: A maximum running time in seconds</li>
<li>
<code>target.fun.value</code>: A threshold for function evaluation (stop if a evaluation is better than a given value)</li>
<li>
<code>max.evals</code>: The maximum number of function evaluations</li>
</ul>
<p><em>Note:</em> You can also create your own stopping condition(s).</p>
</div>
<div id="setmbocontrolmultipoint" class="section level3">
<h3 class="hasAnchor">
<html><body><a href="#setmbocontrolmultipoint" class="anchor"> </a></body></html>setMBOControlMultiPoint</h3>
<p>This extends a MBO control object with options for multipoint proposal. Multipoint proposal means, that multiple points are proposed and evaluated, which is especially useful for parallel batch evaluation. For a detailed introduction, check the Vignette on parallelization.</p>
</div>
<div id="setmbocontrolmulticrit" class="section level3">
<h3 class="hasAnchor">
<html><body><a href="#setmbocontrolmulticrit" class="anchor"> </a></body></html>setMBOControlMultiCrit</h3>
<p>This adds multi-criteria optimization specific options to the control object. For details see the Vignette on <em>multi-criteria optimization</em>.</p>
</div>
<div id="experiments-and-output" class="section level3">
<h3 class="hasAnchor">
<html><body><a href="#experiments-and-output" class="anchor"> </a></body></html>Experiments and Output</h3>
<p>Although we presented various options we will mainly go with the defaults settings.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ctrl =<span class="st"> </span><span class="kw"><a href="../reference/makeMBOControl.html">makeMBOControl</a></span>()
ctrl =<span class="st"> </span><span class="kw"><a href="../reference/setMBOControlInfill.html">setMBOControlInfill</a></span>(
  <span class="dt">control =</span> ctrl,
  <span class="dt">crit =</span> <span class="kw"><a href="../reference/infillcrits.html">makeMBOInfillCriterionEI</a></span>()
)
ctrl =<span class="st"> </span><span class="kw"><a href="../reference/setMBOControlTermination.html">setMBOControlTermination</a></span>(
  <span class="dt">control =</span> ctrl,
  <span class="dt">iters =</span> <span class="dv">10</span>
)</code></pre></div>
<p>Now we will apply the <code><a href="../reference/mbo.html">mbo()</a></code> function to optimize the objective function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">res =<span class="st"> </span><span class="kw"><a href="../reference/mbo.html">mbo</a></span>(objfun1, <span class="dt">design =</span> des, <span class="dt">learner =</span> surr.km, <span class="dt">control =</span> ctrl, <span class="dt">show.info =</span> <span class="ot">FALSE</span>)
<span class="kw">print</span>(res)
## Recommended parameters:
## x=9.21,2.34
## Objective: y = 0.628
## 
## Optimization path
## 10 + 10 entries in total, displaying last 10 (or less):
##           x1           x2          y dob eol error.message exec.time
## 11  9.103357 1.178894e+00  1.9677581   1  NA          &lt;NA&gt;         0
## 12  7.540709 5.999567e-05 14.7661437   2  NA          &lt;NA&gt;         0
## 13  9.999656 3.039340e+00  1.9426948   3  NA          &lt;NA&gt;         0
## 14  9.999796 1.937189e-03 10.9469730   4  NA          &lt;NA&gt;         0
## 15  9.206508 2.344828e+00  0.6279951   5  NA          &lt;NA&gt;         0
## 16  3.028105 3.291628e+00  1.3179833   6  NA          &lt;NA&gt;         0
## 17  3.407661 1.750343e+00  0.8422412   7  NA          &lt;NA&gt;         0
## 18 -4.999427 1.499945e+01 17.4981957   8  NA          &lt;NA&gt;         0
## 19 -2.533238 1.499985e+01 19.2524001   9  NA          &lt;NA&gt;         0
## 20  3.594135 2.766994e+00  2.0343241  10  NA          &lt;NA&gt;         0
##             ei error.model train.time prop.type propose.time        se
## 11 -10.5773621        &lt;NA&gt;      0.021 infill_ei        0.519 37.257086
## 12  -6.2565311        &lt;NA&gt;      0.017 infill_ei        0.717 21.023677
## 13  -6.8664950        &lt;NA&gt;      0.023 infill_ei        0.542 15.927219
## 14  -3.1049455        &lt;NA&gt;      0.019 infill_ei        0.680 13.807289
## 15  -2.5880333        &lt;NA&gt;      0.029 infill_ei        0.682  3.489611
## 16  -1.3442651        &lt;NA&gt;      0.022 infill_ei        0.657 14.913229
## 17  -1.4339112        &lt;NA&gt;      0.023 infill_ei        0.704  5.884045
## 18  -1.0213269        &lt;NA&gt;      0.026 infill_ei        0.724 37.398039
## 19  -1.2965466        &lt;NA&gt;      0.026 infill_ei        0.593 19.446170
## 20  -0.9392582        &lt;NA&gt;      0.022 infill_ei        0.697  3.001655
##           mean
## 11 22.18138079
## 12  6.64207088
## 13  0.96788339
## 14  7.69041430
## 15 -0.01994806
## 16 14.91983581
## 17  2.75974572
## 18 57.87690570
## 19 22.30097297
## 20  1.18566904</code></pre></div>
<p>The default output of mbo contains the best found parameter set and the optimzation path. The <code>MBOResult</code> object contains additional information, most importantly:</p>
<ul>
<li>
<code>x</code>: The best point of the parameter space</li>
<li>
<code>y</code>: The associated best value of the objective function</li>
<li>
<code>opt.path</code>: The optimization path. See <code>?ParamHelpers::OptPath</code> for further information.</li>
<li>
<code>models</code>: Depending on <code>store.model.at</code> in the <code>MBOControl</code> object, this contains zero, one or multiple surrogate models (default is to save the model generated at the last iteration).</li>
<li>… (see <code><a href="../reference/MBOSingleObjResult.html">?MBOSingleObjResult</a></code>)</li>
</ul>
<p>We can also change some arguments of the <code>MBOControl</code> object and run <code><a href="../reference/mbo.html">mbo()</a></code> again:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ctrl =<span class="st"> </span><span class="kw"><a href="../reference/setMBOControlInfill.html">setMBOControlInfill</a></span>(ctrl, <span class="dt">crit =</span> <span class="kw"><a href="../reference/infillcrits.html">makeMBOInfillCriterionCB</a></span>())
ctrl =<span class="st"> </span><span class="kw"><a href="../reference/setMBOControlTermination.html">setMBOControlTermination</a></span>(ctrl, <span class="dt">iters =</span> 5L)
<span class="kw"><a href="../reference/mbo.html">mbo</a></span>(objfun1, <span class="dt">design =</span> des, <span class="dt">learner =</span> surr.km, <span class="dt">control =</span> ctrl, <span class="dt">show.info =</span> <span class="ot">FALSE</span>)</code></pre></div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#objective-function">Objective Function</a></li>
      <li><a href="#initial-design">Initial Design</a></li>
      <li><a href="#surrogate-model">Surrogate Model</a></li>
      <li><a href="#mbocontrol">MBOControl</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Bernd Bischl, Jakob Bossek, Jakob Richter, Daniel Horn, Michel Lang, Janek Thomas.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
